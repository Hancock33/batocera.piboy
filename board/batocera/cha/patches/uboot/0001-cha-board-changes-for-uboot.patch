From 7f1a34922551acdd61f79115c4a7dda916f0727f Mon Sep 17 00:00:00 2001
From: Demetris Ierokipides <ierokipides.dem@gmail.com>
Date: Mon, 21 Jun 2021 10:20:17 +0300
Subject: [PATCH] cha board changes for uboot

---
 arch/arm/dts/sun8i-h3-orangepi-pc-plus.dts | 38 ++++++++++++++--------
 configs/orangepi_pc_plus_defconfig         |  5 +--
 2 files changed, 27 insertions(+), 16 deletions(-)

diff --git a/arch/arm/dts/sun8i-h3-orangepi-pc-plus.dts b/arch/arm/dts/sun8i-h3-orangepi-pc-plus.dts
index 71fb7320..ecb9aaab 100644
--- a/arch/arm/dts/sun8i-h3-orangepi-pc-plus.dts
+++ b/arch/arm/dts/sun8i-h3-orangepi-pc-plus.dts
@@ -46,16 +46,34 @@
 / {
 	model = "Xunlong Orange Pi PC Plus";
 	compatible = "xunlong,orangepi-pc-plus", "allwinner,sun8i-h3";
+};
 
-	aliases {
-		/* ethernet0 is the H3 emac, defined in sun8i-h3.dtsi */
-		ethernet1 = &rtl8189ftv;
+reg_vdd_cpux: vdd-cpux {
+		compatible = "regulator-fixed";
+		regulator-name = "vdd-cpux";
+		regulator-min-microvolt = <1200000>;
+		regulator-max-microvolt = <1200000>;
+		regulator-always-on;
+		regulator-boot-on;
+		vin-supply = <&reg_vcc5v0>;
+		gpio = <&r_pio 0 5 GPIO_ACTIVE_HIGH>; /* PL5 */
+		enable-active-high;
 	};
+
+&cpu0 {
+	cpu-supply = <&reg_vdd_cpux>;
+};
+
+&cpu1 {
+	cpu-supply = <&reg_vdd_cpux>;
 };
 
-&emac {
-	/* LEDs changed to active high on the plus */
-	/delete-property/ allwinner,leds-active-low;
+&cpu2 {
+	cpu-supply = <&reg_vdd_cpux>;
+};
+
+&cpu3 {
+	cpu-supply = <&reg_vdd_cpux>;
 };
 
 &mmc1 {
@@ -63,14 +81,6 @@
 	bus-width = <4>;
 	non-removable;
 	status = "okay";
-
-	/*
-	 * Explicitly define the sdio device, so that we can add an ethernet
-	 * alias for it (which e.g. makes u-boot set a mac-address).
-	 */
-	rtl8189ftv: sdio_wifi@1 {
-		reg = <1>;
-	};
 };
 
 &mmc2 {
diff --git a/configs/orangepi_pc_plus_defconfig b/configs/orangepi_pc_plus_defconfig
index e2067748..d9982e41 100644
--- a/configs/orangepi_pc_plus_defconfig
+++ b/configs/orangepi_pc_plus_defconfig
@@ -2,8 +2,9 @@ CONFIG_ARM=y
 CONFIG_ARCH_SUNXI=y
 CONFIG_SPL=y
 CONFIG_MACH_SUN8I_H3=y
-CONFIG_DRAM_CLK=624
-CONFIG_MMC_SUNXI_SLOT_EXTRA=2
+CONFIG_DRAM_CLK=667
+CONFIG_SUPPORT_EMMC_BOOT=y
+# CONFIG_MMC_SUNXI_SLOT_EXTRA is not set
 CONFIG_DEFAULT_DEVICE_TREE="sun8i-h3-orangepi-pc-plus"
 # CONFIG_SYS_MALLOC_CLEAR_ON_INIT is not set
 CONFIG_SPL_I2C_SUPPORT=y
-- 
2.25.1

