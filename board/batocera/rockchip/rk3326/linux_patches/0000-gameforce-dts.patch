From 7c328a8929ef276e90a9b78537719626e82e9773 Mon Sep 17 00:00:00 2001
From: Juliano Dorig√£o <jdorigao@gmail.com>
Date: Sat, 1 Apr 2023 18:24:29 -0400
Subject: [PATCH] GameForce DTS

---
 arch/arm64/boot/dts/rockchip/Makefile         |   1 +
 .../dts/rockchip/rk3326-golden-gameforce.dts  | 274 ++++++++++++++++++
 2 files changed, 275 insertions(+)
 create mode 100644 arch/arm64/boot/dts/rockchip/rk3326-golden-gameforce.dts

diff --git a/arch/arm64/boot/dts/rockchip/Makefile b/arch/arm64/boot/dts/rockchip/Makefile
index 0a76a2ebb..d191b5b78 100644
--- a/arch/arm64/boot/dts/rockchip/Makefile
+++ b/arch/arm64/boot/dts/rockchip/Makefile
@@ -9,6 +9,7 @@ dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3308-roc-cc.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3308-rock-pi-s.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3318-a95x-z2.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3326-anbernic-rg351m.dtb
+dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3326-golden-gameforce.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3326-odroid-go2.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3326-odroid-go2-v11.dtb
 dtb-$(CONFIG_ARCH_ROCKCHIP) += rk3326-odroid-go3.dtb
diff --git a/arch/arm64/boot/dts/rockchip/rk3326-golden-gameforce.dts b/arch/arm64/boot/dts/rockchip/rk3326-golden-gameforce.dts
new file mode 100644
index 000000000..a5f7a0a5a
--- /dev/null
+++ b/arch/arm64/boot/dts/rockchip/rk3326-golden-gameforce.dts
@@ -0,0 +1,274 @@
+// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
+/*
+ * Copyright (c) 2020 Hardkernel Co., Ltd
+ */
+
+/dts-v1/;
+#include "rk3326-odroid-go.dtsi"
+
+/ {
+	model = "Golden GameForce";
+	compatible = "rockchip,rk3326-gameforce", "rockchip,rk3326";
+
+	adc-keys {
+		compatible = "volume-keys";
+		keyup-threshold-microvolt = <1800000>;
+
+		button-1 {
+			press-threshold-microvolt = <15000>;
+			label = "volume down";
+			linux,code = <BTN_TRIGGER_HAPPY1>;
+		};
+
+		button-2 {
+			press-threshold-microvolt = <300000>;
+			label = "volume up";
+			linux,code = <BTN_TRIGGER_HAPPY2>;
+		};
+	};
+
+	joypad: gameforce-gamepad {
+		compatible = "gameforce-gamepad";
+		pinctrl-names = "default";
+		pinctrl-0 = <&btn_pins>;
+
+		io-channel-names = "joy_x", "joy_y", "volume-buttons";
+		io-channels = <&saradc 0>, <&saradc 1>, <&saradc 2>;
+
+		button-adc-count = <2>;
+		button-adc-scale = <2>;
+		button-adc-deadzone = <20>;
+
+		button-adc-x-range = <1800>;
+		button-adc-y-range = <1800>;
+
+		button-adc-fuzz = <32>;
+		button-adc-flat = <32>;
+
+		poll-interval = <10>;
+
+		button-sw1 {
+			gpios = <&gpio1 RK_PB4 GPIO_ACTIVE_LOW>;
+			label = "DPAD-UP";
+			linux,code = <BTN_DPAD_UP>;
+		};
+
+		button-sw2 {
+			gpios = <&gpio1 RK_PB5 GPIO_ACTIVE_LOW>;
+			label = "DPAD-DOWN";
+			linux,code = <BTN_DPAD_DOWN>;
+		};
+
+		button-sw3 {
+			gpios = <&gpio1 RK_PB6 GPIO_ACTIVE_LOW>;
+			label = "DPAD-LEFT";
+			linux,code = <BTN_DPAD_LEFT>;
+		};
+
+		button-sw4 {
+			gpios = <&gpio1 RK_PB7 GPIO_ACTIVE_LOW>;
+			label = "DPAD-RIGHT";
+			linux,code = <BTN_DPAD_RIGHT>;
+		};
+
+		button-sw5 {
+			gpios = <&gpio2 RK_PB0 GPIO_ACTIVE_LOW>;
+			label = "BTN-A";
+			linux,code = <BTN_EAST>;
+		};
+
+		button-sw6 {
+			gpios = <&gpio2 RK_PB1 GPIO_ACTIVE_LOW>;
+			label = "BTN-B";
+			linux,code = <BTN_SOUTH>;
+		};
+
+		button-sw7 {
+			gpios = <&gpio2 RK_PB2 GPIO_ACTIVE_LOW>;
+			label = "BTN-Y";
+			linux,code = <BTN_WEST>;
+		};
+
+		button-sw8 {
+			gpios = <&gpio2 RK_PB3 GPIO_ACTIVE_LOW>;
+			label = "BTN-X";
+			linux,code = <BTN_NORTH>;
+		};
+
+		btn_home: button-sw9 {
+			gpios = <&gpio2 RK_PA0 GPIO_ACTIVE_LOW>;
+			label = "BTN-HOME";
+			linux,code = <BTN_TRIGGER_HAPPY3>;
+		};
+
+		btn_select: button-sw10 {
+			gpios = <&gpio2 RK_PA3 GPIO_ACTIVE_LOW>;
+			label = "BTN-SET";
+			linux,code = <BTN_SELECT>;
+		};
+
+		btn_start: button-sw11 {
+			gpios = <&gpio2 RK_PA2 GPIO_ACTIVE_LOW>;
+			label = "BTN-START";
+			linux,code = <BTN_START>;
+		};
+
+		button-sw12 {
+			gpios = <&gpio2 RK_PA6 GPIO_ACTIVE_LOW>;
+			label = "TOP-LEFT";
+			linux,code = <BTN_TL>;
+		};
+
+		button-sw13 {
+			gpios = <&gpio2 RK_PA4 GPIO_ACTIVE_LOW>;
+			label = "TOP-LEFT2";
+			linux,code = <BTN_TL2>;
+		};
+
+		button-sw14 {
+			gpios = <&gpio2 RK_PA7 GPIO_ACTIVE_LOW>;
+			label = "TOP-RIGHT";
+			linux,code = <BTN_TR>;
+		};
+
+		button-sw15 {
+			gpios = <&gpio2 RK_PA5 GPIO_ACTIVE_LOW>;
+			label = "TOP-RIGHT2";
+			linux,code = <BTN_TR2>;
+		};
+	};
+
+	vibrators {
+		compatible = "gpio,vibrators";
+		vibrator0-gpio = <&gpio3 RK_PC3 GPIO_ACTIVE_HIGH>;
+		vibrator1-gpio = <&gpio3 RK_PC2 GPIO_ACTIVE_HIGH>;
+		status = "okay";
+	};
+
+	gpio-leds {
+		compatible = "gpio-leds";
+
+		pinctrl-names = "led_pins";
+		pinctrl-0 = <&led_pins>;
+
+		heartbeat {
+			label = "heartbeat";
+			gpios = <&gpio3 RK_PB3 GPIO_ACTIVE_HIGH>;
+			linux,default-trigger = "heartbeat";
+		};
+
+		red {
+			label = "red";
+			gpios = <&gpio3 RK_PC4 GPIO_ACTIVE_HIGH>;
+			default-state = "off";
+		};
+
+		green {
+			label = "green";
+			gpios = <&gpio3 RK_PC5 GPIO_ACTIVE_HIGH>;
+			default-state = "off";
+		};
+
+		blue {
+			label = "blue";
+			gpios = <&gpio3 RK_PC6 GPIO_ACTIVE_HIGH>;
+			default-state = "off";
+		};
+	};
+
+	battery: battery {
+		compatible = "simple-battery";
+		charge-full-design-microamp-hours = <3000000>;
+		charge-term-current-microamp = <300000>;
+		constant-charge-current-max-microamp = <2000000>;
+		constant-charge-voltage-max-microvolt = <4200000>;
+		factory-internal-resistance-micro-ohms = <180000>;
+		voltage-max-design-microvolt = <4100000>;
+		voltage-min-design-microvolt = <3500000>;
+
+		ocv-capacity-celsius = <20>;
+		ocv-capacity-table-0 =	<4046950 100>, <4001920 95>, <3967900 90>, <3919950 85>,
+								<3888450 80>, <3861850 75>, <3831540 70>, <3799130 65>,
+								<3768190 60>, <3745650 55>, <3726610 50>, <3711630 45>,
+								<3696720 40>, <3685660 35>, <3674950 30>, <3663050 25>,
+								<3649470 20>, <3635260 15>, <3616920 10>, <3592440 5>,
+								<3574170 0>;
+	};
+
+	wifi_pwrseq: wifi-pwrseq {
+		compatible = "mmc-pwrseq-simple";
+		pinctrl-names = "default";
+		pinctrl-0 = <&wifi_pwrseq_pins>;
+		reset-gpios = <&gpio0 RK_PA2 GPIO_ACTIVE_LOW>;
+	};	
+};
+
+&internal_display {
+	compatible = "gameforce,st7703";
+	rotation = <0>;
+};
+
+&rk817_charger {
+	monitored-battery = <&battery>;
+};
+
+&sdio {
+	bus-width = <4>;
+	cap-sd-highspeed;
+	cap-sdio-irq;
+	disable-wp;
+	supports-sdio;
+	ignore-pm-notify;
+	keep-power-in-suspend;
+	non-removable;
+	mmc-pwrseq = <&wifi_pwrseq>;
+	sd-uhs-sdr104;
+	status = "okay";
+
+		rtl8723ds: wifi@1 {
+			compatible = "wlan-platdata";
+			rockchip,grf = <&grf>;
+			wifi_chip_type = "realtek,rtl8723ds";
+			WIFI,host_wake_irq = <&gpio0 RK_PA5 GPIO_ACTIVE_HIGH>;
+			sdio_vref = <3300>;
+			status = "okay";
+		};
+};
+
+&pinctrl {
+	btns {
+		btn_pins: btn-pins {
+			rockchip,pins = <1 RK_PB4 RK_FUNC_GPIO &pcfg_pull_up>,
+							<1 RK_PB5 RK_FUNC_GPIO &pcfg_pull_up>,
+							<1 RK_PB6 RK_FUNC_GPIO &pcfg_pull_up>,
+							<1 RK_PB7 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PB0 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PB1 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PB2 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PB3 RK_FUNC_GPIO &pcfg_pull_up>,
+
+							<2 RK_PA0 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PA2 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PA3 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PA4 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PA5 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PA6 RK_FUNC_GPIO &pcfg_pull_up>,
+							<2 RK_PA7 RK_FUNC_GPIO &pcfg_pull_up>;
+		};
+	};
+
+	leds {
+		led_pins: led-pins {
+			rockchip,pins = <3 RK_PB3 RK_FUNC_GPIO &pcfg_pull_none>,
+							<3 RK_PC4 RK_FUNC_GPIO &pcfg_pull_none>,
+							<3 RK_PC5 RK_FUNC_GPIO &pcfg_pull_none>,
+							<3 RK_PC6 RK_FUNC_GPIO &pcfg_pull_none>;
+		};
+	};
+
+	wifi {
+		wifi_pwrseq_pins: wifi-pwrseq-pins {
+			rockchip,pins = <0 RK_PA2 RK_FUNC_GPIO &pcfg_pull_none>;
+		};
+	};
+};
\ No newline at end of file
-- 
2.40.0

